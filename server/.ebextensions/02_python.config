option_settings:
  aws:elasticbeanstalk:application:environment:
    SECRET_KEY: "change-this-secret-key-in-production"
    JWT_SECRET_KEY: "change-this-jwt-secret-key-in-production"
    DATABASE_URL: "sqlite:///game_library.db"
    FLASK_ENV: "production"
    CORS_ORIGINS: "https://your-amplify-domain.amplifyapp.com"
    YOUTUBE_API_KEY: "your-youtube-api-key"

commands:
  01_install_dependencies:
    command: "pip install -r requirements.txt"
  02_migrate_db:
    command: "python migrate_db.py"
    leader_only: true

files:
  "/etc/httpd/conf.d/ssl_rewrite.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      RewriteEngine On
      <If "-n '%{HTTP:X-Forwarded-Proto}' && %{HTTP:X-Forwarded-Proto} != 'https'">
      RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
      </If>
